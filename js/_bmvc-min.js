/**
 *
 * _bmvc 3.1
 * 
 * A new version of basic mvc. 
 *  
 */(function(){var undefined,isBrowser=typeof global=="undefined"&&typeof require=="undefined",container=isBrowser?window:global,_bmvc=function(){function init(){if(isBrowser){if(domReadyBound)return;domReadyBound=!0,document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),registerAllObjects()},!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){document.readyState==="complete"&&(document.detachEvent("onreadystatechange",arguments.callee),registerAllObjects())}),document.documentElement.doScroll&&container==container.top&&function(){if(!objectsRegistred){try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}registerAllObjects()}}())}else registerAllObjects()}function registerAllObjects(){for(var a in _bmvc.objects)_bmvc.register(_bmvc.objects[a],a);for(var a in _bmvc.models)_bmvc.register(_bmvc.models[a],a,Types.MODEL);for(var a in _bmvc.controls)_bmvc.register(_bmvc.controls[a],a,Types.CONTROL);for(var a in _bmvc.views)_bmvc.register(_bmvc.views[a],a,Types.VIEW);objectsRegistred=!0,_bmvc.sendEvent(new _bmvc.READY,_bmvc)}function getObject(a,b){return allObjectsMap[a+"."+b]}function getInternalName(a,b){var c="";a?c=a:c="_internal_name_"+Math.random().toString().replace(".","")+"."+b;return c}var _bmvc=new function(){this.name="_bmvc"},getInstance=function(){this._instance==null&&(this._instance=new this);return this._instance},getInstanceName=function(a){var b=new a,c=b.name;delete b;return c};_bmvc.getInstanceName=getInstanceName,container.location&&(_bmvc.showLog=location.search.indexOf("log")!=-1),_bmvc.objects={},_bmvc.models={},_bmvc.controls={},_bmvc.views={};var referenceToEventListeners={},objectsRegistred=!1,domReadyBound=!1,Types={MODEL:"model",CONTROL:"control",VIEW:"view"},allObjectsMap={},globalListeners=[];_bmvc.unitTestMode=!1,_bmvc.READY=function(){this.name="_bmvc.READY"};var sendEventForObjects=function(a){_bmvc.sendEvent(a,this)};_bmvc.addListener=function(a,b,c){var d=typeof a=="string"?a:getInstanceName(a);referenceToEventListeners[d]||(referenceToEventListeners[d]=[]),referenceToEventListeners[d].push({handler:b,listeningObject:c});return referenceToEventListeners},_bmvc.addGlobalListeners=function(a){globalListeners.push(a)},_bmvc.removeListener=function(a,b,c){var d=typeof a=="string"?a:getInstanceName(a);referenceToEventListeners[d]||(referenceToEventListeners[d]=[]);var e=referenceToEventListeners[d],f=[];for(var g=0,h=e.length;g<h;g++)c!=e[g].listeningObject&&f.push(e[g]);referenceToEventListeners[d]=f;return referenceToEventListeners[d]},_bmvc.getExposedInstance=function(classRef){var classAsString=classRef.toString(),funcString="";funcString+="new ("+classAsString.substring(0,classAsString.length-1),funcString+=";",funcString+="this._privates = {};\n",funcString+="this._initPrivates = function(f)",funcString+="{",funcString+="var fs = f.toString();",funcString+="var pf = fs.match(/function\\s*?(\\w.*?)\\(/g);",funcString+="this._privates = {};",funcString+="for (var i = 0, ii = pf.length; i < ii; i++)",funcString+="{",funcString+="\tvar fn = pf[i].replace(/(function\\s+)/, '').replace('(', '');",funcString+="\tthis._privates[fn] = eval(fn);",funcString+="}",funcString+="}",funcString+="\n\n})()";var instance=eval(funcString);instance._initPrivates(classAsString),delete instance._initPrivates;return instance},_bmvc.register=function(a,b,c){a.getInstance=getInstance;var d=null;_bmvc.unitTestMode?(d=_bmvc.getExposedInstance(a),d.sendEvent=sendEventForObjects):(a.prototype.sendEvent=sendEventForObjects,d=a.getInstance()),d.name=getInternalName(b,c),c?(d.typeName=d.name+"."+c,c==Types.CONTROL&&(d.model=getObject(d.name,Types.MODEL)),c==Types.VIEW&&(d.control=getObject(d.name,Types.CONTROL),d.model=getObject(d.name,Types.MODEL))):d.typeName=d.name,allObjectsMap[d.typeName]=d,_bmvc.showLog&&console.log("BasicMVC: Register ",d.typeName);var e=d.eventListeners();if(e&&!_bmvc.unitTestMode)for(var f=0,g=e.length;f<g;f++){var h=e[f];_bmvc.addListener(h.event,h.handler,d)}},_bmvc.addGlobalListener=function(a){globalListeners.push(a)},_bmvc.sendEvent=function(a,b){if(!_bmvc.unitTestMode){var c=typeof a=="string"?a:a.name;_bmvc.showLog&&(b=b?b:{name:"_root"},console.info("BasicMVC EVENT (sent from '"+b.name+"'): "+c+" - ",a));var d=referenceToEventListeners[c];if(d)for(var e=0,f=d.length;e<f;e++){var g=d[e].listeningObject;typeof a=="string"?d[e].handler.apply(this,Array.prototype.slice.call(arguments,1)):d[e].handler.call(g,a)}for(var e=0,f=globalListeners.length;e<f;e++){var g=globalListeners[e];g.call(g,a)}}},_bmvc.addNamespace=function(a){var b=a.split("."),c=container;for(var d=0,e=b.length;d<e;d++)c=c[b[d]]=c[b[d]]||{};return c},_bmvc.map=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++)c.push(b(a[d]));return c},_bmvc.forEach=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){var f=b(a[d],d);f&&c.push(f)}return c},_bmvc.forEachDelay=function(a,b,c,d){var d=d!=null?d:a.length,e=this,f=d-a.length,g=a.shift();b(g,f),a.length>0&&setTimeout(function(){e.forEachDelay(a,b,c,d)},c)},init();return _bmvc}();container._bmvc=_bmvc})()